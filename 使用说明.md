# 🧠 QNMDsol 使用说明（Windows）
**Quick Neural Mind-Driven Souls-like Controller (Demo)**

本文档用于指导你在 Windows 上运行 QNMDsol（SIM 模式/REAL 模式）、配置 Steam Input，并进行基础校准与数据录制。

---

## 1. 环境准备

### 1.1 硬件（可选）
- OpenBCI Cyton + Daisy（16 通道）
- OpenBCI USB Dongle

### 1.2 软件
1. Windows 10 / 11（64 位）
2. Rust 工具链（stable）
3. vJoy 驱动：https://github.com/shauleiz/vJoy/releases
4. BrainFlow 运行库（放在项目根目录）：
   - `BoardController.dll`
   - `DataHandler.dll`
   - `vJoyInterface.dll`

---

## 2. 运行程序（SIM/REAL）

在项目根目录执行：

```bash
cargo run
```

### 2.1 SIM 模式（无硬件）
用途：验证 UI/波形/频谱/vJoy 输出与 Steam 映射是否正常。

步骤：
1. UI 里选择 **SIM**
2. 点击 **CONNECT** → **START STREAM**
3. 默认键盘控制（示例）：
   - `W/A/S/D`：左摇杆
   - `I/J/K/L`：右摇杆
   - `Space`：A
   - `Z/X/C`：B/X/Y

### 2.2 REAL 模式（硬件）
步骤：
1. UI 里选择 **REAL**
2. 从下拉框选择正确串口（程序会自动扫描串口）
3. 点击 **CONNECT** → **START STREAM**

---

## 3. 🔴 游戏识别（Steam Input / XInput 转换）

许多游戏只识别 Xbox（XInput）手柄，而 vJoy 属于 DirectInput，需要“转换层”。推荐使用 Steam 自带的 Steam Input：

1. Steam → **设置** → **控制器** → 勾选 **启用通用游戏手柄配置支持**
2. 游戏 → **属性** → **控制器** → 选择 **启用 Steam Input**
3. **控制器布局** 中，将 QNMDsol 输出的轴/按钮映射到 Xbox 按键/摇杆
4. 建议使用程序内的 **Binding Helper / 绑定助手窗口** 来发脉冲，保证 Steam 绑定界面能稳定识别

---

## 4. 校准（阈值）

校准页提供两步：
1. **录制静息（Relax）**：记录基线峰值
2. **录制动作（Action）**：记录动作峰值

完成两步后会自动计算并下发触发阈值。

---

## 5. 数据录制（用于训练）

在连接并开始采集后：
- 输入标签（如 `Attack` / `Rest`）
- 点击 🔴 **RECORD** 开始录制，再点击停止
- CSV 将保存在项目根目录（`training_data_*.csv`）

---

## 6. 离线训练（CSP+LDA）

在已有 `training_data_*.csv` 的前提下，运行：

```bat
trainer\run_all.bat
```

输出：项目根目录 `brain_model.json`

---

## 7. 常见问题（FAQ）

**Q: 点 CONNECT 直接闪退/报 DLL 错误？**  
A: 99% 是缺 DLL。请确认 `BoardController.dll` / `DataHandler.dll` / `vJoyInterface.dll` 在项目根目录，且 vJoy 已安装启用。

**Q: REAL 模式连接失败 / Port Open Failed？**  
A: 确认 dongle 插好、端口选择正确、没有其它软件（如 OpenBCI GUI）占用串口。

**Q: SIM 模式下按键没反应？**  
A: 确认已点击 **START STREAM** 且程序窗口获得焦点；或用 Binding Helper 发脉冲做 Steam 绑定。

